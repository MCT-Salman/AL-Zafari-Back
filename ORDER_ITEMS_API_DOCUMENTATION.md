# ุชูุซูู API ูุฅุฏุงุฑุฉ ุนูุงุตุฑ ุงูุทูุจุงุช ูุญุงูุฉ ุงูุทูุจ

ุชู ุฅุถุงูุฉ 4 endpoints ุฌุฏูุฏุฉ ูุฅุฏุงุฑุฉ ุนูุงุตุฑ ุงูุทูุจุงุช ุจุดูู ูููุตู ูุชุนุฏูู ุญุงูุฉ ุงูุทูุจ.

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ุฅุถุงูุฉ ุนูุตุฑ ูุทูุจ](#1-ุฅุถุงูุฉ-ุนูุตุฑ-ูุทูุจ)
2. [ุชุนุฏูู ุนูุตุฑ ูู ุทูุจ](#2-ุชุนุฏูู-ุนูุตุฑ-ูู-ุทูุจ)
3. [ุญุฐู ุนูุตุฑ ูู ุทูุจ](#3-ุญุฐู-ุนูุตุฑ-ูู-ุทูุจ)
4. [ุชุนุฏูู ุญุงูุฉ ุทูุจ](#4-ุชุนุฏูู-ุญุงูุฉ-ุทูุจ)

---

## 1. ุฅุถุงูุฉ ุนูุตุฑ ูุทูุจ

### Endpoint
```
POST /order/:id/items
```

### ุงูุตูุงุญูุงุช
- Admin
- Sales
- Accountant

### Parameters
- `id` (path parameter): ูุนุฑู ุงูุทูุจ

### Request Body
```json
{
  "type_item": 1,
  "ruler_id": 1,
  "constant_width": 10.5,
  "length": 100.0,
  "constant_thickness": 2.5,
  "batch_id": 1,
  "quantity": 50,
  "unit_price": 25.50,  // ุงุฎุชูุงุฑู - ุณูุชู ุญุณุงุจู ุชููุงุฆูุงู ูู PriceColor
  "notes": "ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ"
}
```

### Response
```json
{
  "success": true,
  "message": "ุชู ุฅุถุงูุฉ ุงูุนูุตุฑ ููุทูุจ ุจูุฌุงุญ",
  "data": {
    "item": {
      "order_item_id": 123,
      "order_id": 1,
      "type_item": 1,
      "ruler_id": 1,
      "constant_width": 10.5,
      "length": 100.0,
      "constant_thickness": 2.5,
      "batch_id": 1,
      "quantity": 50,
      "unit_price": 25.50,
      "subtotal": 1275.00,
      "notes": "ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ",
      "ruler": { ... },
      "batch": { ... }
    },
    "order": {
      "order_id": 1,
      "total_amount": 5000.00,  // ุชู ุชุญุฏูุซู ุชููุงุฆูุงู
      "customer": { ... },
      "sales": { ... },
      "items": [ ... ]
    }
  }
}
```

### ููุงุญุธุงุช
- โ ูุชู ุญุณุงุจ `unit_price` ุชููุงุฆูุงู ูู `PriceColor` ุฅุฐุง ูู ูุชู ุชูุฑูุฑู
- โ ูุชู ุญุณุงุจ `subtotal` ุชููุงุฆูุงู (unit_price ร quantity)
- โ ูุชู ุชุญุฏูุซ `total_amount` ููุทูุจ ุชููุงุฆูุงู
- โ ูุชู ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุทุฑุฉ ูุงูุทุจุฎุฉ
- โ ุงูุนูููุฉ ุชุชู ูู ูุนุงููุฉ ูุงุญุฏุฉ (Transaction)

---

## 2. ุชุนุฏูู ุนูุตุฑ ูู ุทูุจ

### Endpoint
```
PUT /order/:id/items/:itemId
```

### ุงูุตูุงุญูุงุช
- Admin
- Sales
- Accountant

### Parameters
- `id` (path parameter): ูุนุฑู ุงูุทูุจ
- `itemId` (path parameter): ูุนุฑู ุนูุตุฑ ุงูุทูุจ

### Request Body
```json
{
  "type_item": 2,
  "ruler_id": 2,
  "constant_width": 15.0,
  "length": 150.0,
  "constant_thickness": 3.0,
  "batch_id": 2,
  "quantity": 30,
  "unit_price": 35.00,  // ุงุฎุชูุงุฑู
  "notes": "ููุงุญุธุงุช ูุญุฏุซุฉ"
}
```

**ููุงุญุธุฉ:** ุฌููุน ุงูุญููู ุงุฎุชูุงุฑูุฉ - ููููู ุชุญุฏูุซ ุญูู ูุงุญุฏ ุฃู ุฃูุซุฑ.

### Response
```json
{
  "success": true,
  "message": "ุชู ุชุญุฏูุซ ุนูุตุฑ ุงูุทูุจ ุจูุฌุงุญ",
  "data": {
    "item": {
      "order_item_id": 123,
      "order_id": 1,
      "type_item": 2,
      "ruler_id": 2,
      "constant_width": 15.0,
      "length": 150.0,
      "constant_thickness": 3.0,
      "batch_id": 2,
      "quantity": 30,
      "unit_price": 35.00,
      "subtotal": 1050.00,
      "notes": "ููุงุญุธุงุช ูุญุฏุซุฉ",
      "ruler": { ... },
      "batch": { ... }
    },
    "order": {
      "order_id": 1,
      "total_amount": 4775.00,  // ุชู ุชุญุฏูุซู ุชููุงุฆูุงู
      "customer": { ... },
      "sales": { ... },
      "items": [ ... ]
    }
  }
}
```

### ููุงุญุธุงุช
- โ ูุชู ุฅุนุงุฏุฉ ุญุณุงุจ `unit_price` ุชููุงุฆูุงู ุฅุฐุง ุชุบูุฑุช ุงููุณุทุฑุฉ ุฃู ุงูุทุจุฎุฉ
- โ ูุชู ุฅุนุงุฏุฉ ุญุณุงุจ `subtotal` ุชููุงุฆูุงู
- โ ูุชู ุชุญุฏูุซ `total_amount` ููุทูุจ ุจูุงุกู ุนูู ุงููุฑู
- โ ูุชู ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุทุฑุฉ ูุงูุทุจุฎุฉ ุงูุฌุฏูุฏุฉ
- โ ุงูุนูููุฉ ุชุชู ูู ูุนุงููุฉ ูุงุญุฏุฉ (Transaction)

---

## 3. ุญุฐู ุนูุตุฑ ูู ุทูุจ

### Endpoint
```
DELETE /order/:id/items/:itemId
```

### ุงูุตูุงุญูุงุช
- Admin
- Sales
- Accountant

### Parameters
- `id` (path parameter): ูุนุฑู ุงูุทูุจ
- `itemId` (path parameter): ูุนุฑู ุนูุตุฑ ุงูุทูุจ

### Response
```json
{
  "success": true,
  "message": "ุชู ุญุฐู ุนูุตุฑ ุงูุทูุจ ุจูุฌุงุญ",
  "data": {
    "deletedItem": {
      "order_item_id": 123,
      "order_id": 1,
      "subtotal": 1275.00
    },
    "order": {
      "order_id": 1,
      "total_amount": 3500.00,  // ุชู ุชุญุฏูุซู ุชููุงุฆูุงู
      "customer": { ... },
      "sales": { ... },
      "items": [ ... ]  // ุงูุนูุงุตุฑ ุงููุชุจููุฉ
    }
  }
}
```

### ููุงุญุธุงุช
- โ ูุชู ุชุญุฏูุซ `total_amount` ููุทูุจ ุชููุงุฆูุงู
- โ ูุง ูููู ุญุฐู ุงูุนูุตุฑ ุงููุญูุฏ ูู ุงูุทูุจ (ูุฌุจ ุฃู ูุญุชูู ุงูุทูุจ ุนูู ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู)
- โ ุงูุนูููุฉ ุชุชู ูู ูุนุงููุฉ ูุงุญุฏุฉ (Transaction)

---

## 4. ุชุนุฏูู ุญุงูุฉ ุทูุจ

### Endpoint
```
PATCH /order/:id/status
```

### ุงูุตูุงุญูุงุช
- Admin
- Sales
- Accountant

### Parameters
- `id` (path parameter): ูุนุฑู ุงูุทูุจ

### Request Body
```json
{
  "status": "preparing"
}
```

### ุงูููู ุงููุณููุญุฉ ููุญุงูุฉ
- `pending` - ููุฏ ุงูุงูุชุธุงุฑ
- `preparing` - ููุฏ ุงูุชุญุถูุฑ
- `canceled` - ููุบู
- `completed` - ููุชูู

### Response
```json
{
  "success": true,
  "message": "ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุจูุฌุงุญ",
  "data": {
    "order_id": 1,
    "customer_id": 1,
    "sales_user_id": 2,
    "status": "preparing",
    "total_amount": 5000.00,
    "created_at": "2024-01-15T10:30:00.000Z",
    "notes": "ููุงุญุธุงุช ุงูุทูุจ",
    "customer": { ... },
    "sales": { ... },
    "items": [ ... ]
  }
}
```

### ููุงุญุธุงุช
- โ ุชุญุฏูุซ ุณุฑูุน ููุญุงูุฉ ููุท ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุนูุงุตุฑ
- โ ูุชู ุงูุชุญูู ูู ูุฌูุฏ ุงูุทูุจ
- โ ูุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ

---

## ๐ ุงููุตุงุฏูุฉ ูุงูุตูุงุญูุงุช

ุฌููุน ุงูู endpoints ุชุชุทูุจ:
1. **Authentication:** ูุฌุจ ุฅุฑุณุงู JWT token ูู ุงูู header
2. **Authorization:** ุงูุตูุงุญูุงุช ุงููุทููุจุฉ ููู endpoint:

| Endpoint | Admin | Sales | Accountant |
|----------|-------|-------|------------|
| POST /order/:id/items | โ | โ | โ |
| PUT /order/:id/items/:itemId | โ | โ | โ |
| DELETE /order/:id/items/:itemId | โ | โ | โ |
| PATCH /order/:id/status | โ | โ | โ |

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ูุทูุจ
```bash
curl -X POST http://localhost:3000/order/1/items \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "type_item": 1,
    "ruler_id": 5,
    "constant_width": 12.0,
    "length": 120.0,
    "constant_thickness": 2.0,
    "batch_id": 3,
    "quantity": 40
  }'
```

### ูุซุงู 2: ุชุนุฏูู ูููุฉ ุนูุตุฑ
```bash
curl -X PUT http://localhost:3000/order/1/items/123 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "quantity": 60
  }'
```

### ูุซุงู 3: ุญุฐู ุนูุตุฑ ูู ุทูุจ
```bash
curl -X DELETE http://localhost:3000/order/1/items/123 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### ูุซุงู 4: ุชุบููุฑ ุญุงูุฉ ุทูุจ ุฅูู "ููุชูู"
```bash
curl -X PATCH http://localhost:3000/order/1/status \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "completed"
  }'
```

---

## โ๏ธ ุฑุณุงุฆู ุงูุฃุฎุทุงุก ุงููุญุชููุฉ

### 404 - Not Found
- "ุงูุทูุจ ุบูุฑ ููุฌูุฏ"
- "ุนูุตุฑ ุงูุทูุจ ุบูุฑ ููุฌูุฏ"
- "ุงููุณุทุฑุฉ ุบูุฑ ููุฌูุฏุฉ"
- "ุงูุทุจุฎุฉ ุบูุฑ ููุฌูุฏุฉ"
- "ูู ูุชู ุงูุนุซูุฑ ุนูู ุณุนุฑ ููุฐู ุงููุณุทุฑุฉ ูุงูุทุจุฎุฉ"

### 400 - Bad Request
- "ูุง ูููู ุญุฐู ุงูุนูุตุฑ ุงููุญูุฏ ูู ุงูุทูุจ"
- "ุงูุญุงูุฉ ูุฌุจ ุฃู ุชููู pending ุฃู preparing ุฃู canceled ุฃู completed"

### 401 - Unauthorized
- "ุบูุฑ ูุตุฑุญ ุจุงููุตูู"

### 403 - Forbidden
- "ููุณ ูุฏูู ุงูุตูุงุญูุงุช ุงููุงููุฉ"

---

## โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

1. **ุญุณุงุจ ุชููุงุฆู ููุฃุณุนุงุฑ:** ูุชู ุฌูุจ ุงูุณุนุฑ ูู `PriceColor` ุชููุงุฆูุงู
2. **ุชุญุฏูุซ ุชููุงุฆู ูููุจุงูุบ:** ูุชู ุชุญุฏูุซ `total_amount` ููุทูุจ ุชููุงุฆูุงู
3. **ูุนุงููุงุช ุขููุฉ:** ุฌููุน ุงูุนูููุงุช ุชุชู ูู Transactions
4. **ุงูุชุญูู ุงูุดุงูู:** ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูููุงูุงุช ุงููุฑุชุจุทุฉ
5. **ุญูุงูุฉ ุงูุจูุงูุงุช:** ูุง ูููู ุญุฐู ุงูุนูุตุฑ ุงููุญูุฏ ูู ุงูุทูุจ
6. **ุชุณุฌูู ูุงูู:** ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ูู ุงูู logs

---

ุชู ุฅูุดุงุก ูุฐู ุงูู APIs ุจูุฌุงุญ! ๐

